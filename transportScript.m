%% neutronTransport

a = 1;
I = 100;
N = 8;
xspace = linspace(0, a, I);
delta = xspace(3) - xspace(1);
psi = zeros(N, I);
% vacuum boundary conditions on both sides
psi(:,1) = 0; psi(:,end) = 0;

sig = 2.74e-24; % barns to cm^2
sigV = zeros(1, length(psi));
sigV(1:end) = sig;

% P_N quadrature; N = 8
mu_n = [-0.9602898564,-0.7966664774,-0.5255324099,-0.18343464240,0.1834346424,0.52553240990,0.7966664774,0.9602898564];
w_n = [-0.1012285363,-0.2223810344,-0.3137066459,-0.3626837834,0.3626837834,0.3137066459,0.2223810344,0.1012285363];

phi = zeros(1, I);
phiPrev = zeros(1,length(phi));
error = 10;
err = 10^-9;
S = 10e-5; % what do you set this source to?
q = zeros(1, I);
q(1:end) = sig/2*phi0 + S;

while error > err
    
    for n = 1:length(mu_n)
        
        if mu_n(n) > 0
            
            for i = 2:2:I-1
                
                psi(n,i) = (1 + 0.5*sigV(i)*delta/abs(mu_n(n)))^(-1)*(psi(n,i-1) + 0.5*delta*q(i)/abs(mu_n(n)));
                psi(n,i+1) = 2*psi(n,i) - psi(n,i-1);
            end
            
        else
            for i = I-1:-2:2
                
                psi(n,i) = (1 + 0.5*sigV(i)*delta/abs(mu_n(n)))^(-1)*(psi(n,i+1) + 0.5*delta*q(i)/abs(mu_n(n)));
                psi(n,i-1) = 2*psi(n,i) - psi(n,i+1);
            end
        end
        
    end
    
    for i = 2:2:I-1
        phi(i) = dot(w_n, psi(:,i));
        q(i) = 0.5*sigV(i)*phi(i) + S;
    end
    
    error = max(abs(phiPrev - phi));
    phiPrev = phi;
    
end
    

psiExact = [1,        0.98740095 0.97496063 0.96267705 0.95054823 0.93857222...
 0.9267471  0.91507096 0.90354193 0.89215816 0.88091781 0.86981908...
 0.85886018 0.84803935 0.83735486 0.82680498 0.81638802 0.8061023...
 0.79594618 0.78591801 0.77601618 0.76623911 0.75658523 0.74705297...
 0.73764081 0.72834723 0.71917074 0.71010987 0.70116316 0.69232917...
 0.68360648 0.67499368 0.6664894  0.65809226 0.64980092 0.64161405...
 0.63353032 0.62554843 0.61766711 0.60988509 0.60220112 0.59461395...
 0.58712238 0.57972519 0.5724212  0.56520924 0.55808814 0.55105675...
 0.54411396 0.53725864 0.53048969 0.52380602 0.51720656 0.51069025...
 0.50425603 0.49790288 0.49162978 0.48543571 0.47931968 0.4732807...
 0.46731781 0.46143005 0.45561647 0.44987613 0.44420812 0.43861152...
 0.43308543 0.42762896 0.42224124 0.4169214  0.41166858 0.40648195...
 0.40136066 0.3963039  0.39131084 0.38638069 0.38151266 0.37670596...
 0.37195983 0.36727348 0.36264619 0.35807719 0.35356575 0.34911116...
 0.34471269 0.34036963 0.3360813  0.33184699 0.32766603 0.32353775...
 0.31946148 0.31543657 0.31146237 0.30753824 0.30366355 0.29983767...
 0.29606    0.29232993 0.28864684 0.28501017];

psiApprox = [0.99370039 0.98118054 0.96881843 0.95661207 0.9445595  0.93265879...
 0.92090801 0.90930529 0.89784875 0.88653655 0.87536688 0.86433794...
 0.85344795 0.84269517 0.83207787 0.82159434 0.81124289 0.80102186...
 0.79092961 0.78096451 0.77112496 0.76140939 0.75181622 0.74234392...
 0.73299097 0.72375585 0.71463709 0.70563322 0.69674279 0.68796437...
 0.67929656 0.67073795 0.66228717 0.65394287 0.6457037  0.63756834...
 0.62953547 0.62160381 0.61377209 0.60603904 0.59840342 0.590864...
 0.58341957 0.57606894 0.56881092 0.56164435 0.55456807 0.54758094...
 0.54068185 0.53386967 0.52714333 0.52050174 0.51394382 0.50746853...
 0.50107482 0.49476167 0.48852805 0.48237298 0.47629546 0.4702945...
 0.46436916 0.45851847 0.45274149 0.4470373  0.44140498 0.43584362...
 0.43035233 0.42493023 0.41957644 0.4142901  0.40907037 0.4039164...
 0.39882737 0.39380245 0.38884085 0.38394176 0.37910439 0.37432797...
 0.36961173 0.36495491 0.36035676 0.35581654 0.35133353 0.346907...
 0.34253625 0.33822056 0.33395924 0.32975161 0.325597   0.32149473...
 0.31744415 0.3134446  0.30949544 0.30559604 0.30174577 0.297944...
 0.29419014 0.29048357 0.28682371 0.28320995];

plot(xspace, psiExact,...
    xspace, psiApprox)
    
    



